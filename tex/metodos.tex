%--------------------------------------------------------------------------------------
% Este arquivo contém a sua metodologia
%--------------------------------------------------------------------------------------
\chapter{Metodologia} \label{ch:MM} %Uma label é como você referencia uma seção no texto com a tag \ref{}
Neste capítulo, será apresentada a metodologia aplicada para o desenvolvimento deste produto do Trabalho de Conclusão de Curso (TCC), que possui natureza técnica 
e tem como objetivo a adapatação do processo de \textit{Behavior-Driven Development} (BDD) ao contexto da Engenharia Automotiva. A prova de conceito é realizada a 
partir da aplicação da metodologia na produção de um sistema de travamento de portas veicular. 

Esta é uma pesquisa aplicada, voltada à solução de complexidades presentes em metodologias de desenvolvimento de produto tradicionais como a rastreabilidade de 
requisitos e a execução de testes manuais. Para a avaliação dos resultados, foi aplicada uma abordagem quantitativa, com a finalidade de metrificar a cobertura 
dos testes de caixa-preta desenvolvidos sobre o modelo do sistema, além de identificar falhas que guiam a sua implementação. 

\section{\textbf{Procedimentos Metodológicos}}
Este produto teve seu desenvolvimento com base na metodologia do processo de BDD como demonstrado em \citeonline{studyBDD}, com uma série de adaptações específicas 
para o contexto da Engenharia Automotiva, resultando nas seguintes etapas:
\begin{enumerate}
    \item Descrição das histórias de usuário: Capturar as histórias definidas em forma de requisitos funcionais com linguagem natural e que capture o valor 
    gerado pela perspectiva do usuário;
    \item Mapeamento de exemplos: Definição de exemplos concretos tomados da perspectiva do usuário final;
    \item Desenho do diagrama de caixa preta: Desenho do diagrama do sistema que demonstra suas interfaces de entrada e saída, sem demonstrar detalhes de suas interações;
    \item Desenvolvimento dos cenários Gherkin: Escrita dos cenários aplicando o padrão cucumber e que aborde todas as regras definidas;
    \item Modelagem iterativa do sistema em simulink: Modelagem feita de forma iterativa com a criação das definições de passos dos cenários, seguido da sua aplicação como critérios de aceitação;
    \item Análise quantitativa do produto final: Validação dos resultados obtidos nas etapas anteriores.
\end{enumerate}

Durante a primeira etapa (\ref{sbs:etapa1}), foram elaboradas as histórias de usuário que descrevem as funcionalidades a serem implementadas no sistema, considerando 
a perspectiva do usuário final. Para essa definição, utilizou-se como referência a bibliografia disponível sobre o funcionamento de sistemas de travamento de portas 
em veículos, com destaque para os exemplos da Volkswagen \cite{vwLocking} e da Bosch \cite{bosch2022handbook,reif2017locking}.

Concluída essa fase, a segunda etapa (\ref{sbs:etapa2}) concentrou-se na aplicação do mapeamento de exemplos, cujo objetivo é refinar o design do sistema ao explicitar 
a utilização das funcionalidades sob a perspectiva do usuário. Nesse processo, foram definidos os seguintes elementos:

\begin{itemize}
    \item Exemplos concretos de uso da funcionalidade, descritos pela perspectiva do usuário;
    \item Regras de comportamento que esclarecem a resposta esperada do sistema diante dos exemplos apresentados;
    \item Questões consideradas não pertinentes para a definição dos exemplos, mas que são respondidas ao término da elaboração da história.
\end{itemize}

As perguntas levantadas durante a definição dos exemplos poderiam, em princípio, ser respondidas apenas ao final do processo, uma vez que não impactam diretamente a 
especificação dos comportamentos do sistema. Contudo, optou-se por tratá-las antes de avançar para as histórias seguintes, a fim de garantir um entendimento mais 
detalhado do comportamento esperado e permitir a evolução incremental das funcionalidades definidas.

Na terceira etapa (\ref{sbs:etapa3}), elaborou-se um diagrama do sistema no formato de caixa-preta, utilizado como suporte para a criação dos cenários em \textit{Gherkin}, 
definindo as interações com o sistema que devem ser utilizadas durante os passos. Esse diagrama também serve como base para a modelagem no Simulink, especificando as 
entradas e saídas necessárias para a execução dos testes.

Na quarta etapa (\ref{sbs:etapa4}), são definidos os cenários em \textit{Gherkin}, que especificam o comportamento esperado do sistema e funcionam como testes de 
aceitação das histórias de usuário. Cada exemplo levantado durante o mapeamento deve ser representado em um ou mais cenários, assegurando que todas as interações 
previstas estejam contempladas nos testes.

A quinta etapa (\ref{sbs:etapa5}) consiste na modelagem iterativa do sistema, orientada pela execução dos testes de aceitação definidos nos cenários. Esse processo 
é realizado por meio da repetição cíclica dos seguintes passos:

\begin{enumerate}
    \item Executar os cenários de uma das histórias de usuário a partir do arquivo \textbf{.feature};
    \item Identificar os erros reportados na execução dos testes;
    \item Implementar as correções no modelo, nos passos ou na definição dos passos;
    \item Repetir os passos 1 a 3 até que todas as falhas sejam corrigidas e os testes da história sejam aprovados;
    \item Aprovar a história, caso todos os seus cenários tenham sido validados com sucesso;
    \item Executar novamente os testes das histórias já aprovadas para verificar possíveis falhas introduzidas pela implementação de novos comportamentos;
    \item Corrigir eventuais falhas identificadas nas histórias de usuário anteriores;
    \item Repetir o ciclo para a história seguinte.
\end{enumerate}

Dessa forma, a execução dos testes ocorre de maneira repetitiva, assegurando que a evolução gradual do sistema não comprometa comportamentos previamente aprovados. 
Essa verificação contínua amplia a cobertura dos testes, permitindo identificar conflitos entre diferentes histórias de usuário e aumentando a robustez do sistema, 
dos cenários e das definições de passo.

Ao término da modelagem iterativa, todo o conjunto de cenários de todas as histórias de usuário deve ser executado como uma validação final, garantindo que o 
comportamento especificado para o sistema seja plenamente atendido.

Por fim, na sexta etapa (\ref{sbs:etapa6}), realiza-se uma análise quantitativa dos resultados obtidos durante a aplicação do processo. Nessa fase, são apresentadas 
instâncias de falhas detectadas graças à maior cobertura de testes proporcionada pelo desenvolvimento iterativo.

\section{\textbf{Ferramentas Utilizadas}}
As ferramentas e tecnologias adotadas no desenvolvimento deste produto foram escolhidas com base na compatibilidade com o modelo proposto e na sua capacidade 
de integrar diferentes etapas do processo. A seguir, descreve-se cada uma delas:

\begin{itemize}
    \item \textbf{Cucumber (Gherkin)}: utilizado como padrão para a escrita de cenários comportamentais, permitindo a especificação dos requisitos no formato Given-When-Then, de forma legível por humanos e máquinas;
    \item \textbf{Miro}: website empregado para a criação de diagramas não técnicos, bem como para auxiliar na discussão colaborativa de exemplos, fluxos e histórias de usuário;
    \item \textbf{Visual Studio Code}: ambiente de desenvolvimento (IDE) utilizado para escrever os cenários em Gherkin, desenvolver a tradução para testes executáveis e integrar o código gerado ao microcontrolador;
    \item \textbf{Python}: linguagem escolhida para implementar a lógica de tradução dos cenários Gherkin em testes executáveis, permitindo automatização e validação do comportamento esperado do sistema.
    \begin{itemize}
        \item \textbf{Behave}: biblioteca utilizada para interpretar e executar os cenários comportamentais no formato BDD, integrando as especificações Gherkin à lógica de teste.
        \item \textbf{Matlab Engine API for Python}: biblioteca usada para permitir a comunicação entre scripts Python e o ambiente Simulink, possibilitando a execução dos testes durante a simulação.
    \end{itemize}    
    \item \textbf{Simulink}: ferramenta adotada para a modelagem do sistema embarcado funcional, possibilitando simulações e geração automática de código C para o sistema-alvo.
    \item \textbf{Git/Github}: utilizado para o versionamento do projeto que inclui o modelo simulink do sistema, código embarcado gerado do modelo, arquivos feature dos cenários gherkin e códigos python dos testes executáveis.

\end{itemize}

\section{\textbf{Critérios de Avaliação}}
Para a verificação e validação do produto gerado, serão aplicados critérios quantitativos de análise, com base nos testes de aceitação de cada história de usuário. Este 
processo será realizado durante as etapa 5 (\ref{sbs:etapa5}) e 6 (\ref{sbs:etapa6}), correspondente à modelagem iterativa do sistema no Simulink e à análise dos 
resultados obtidos.

A cada iteração da modelagem, os testes de aceitação de uma história de usuário serão executados e, com base nos cenários não aprovados, serão identificadas falhas 
no comportamento do modelo. A partir dessas falhas, serão implementadas soluções para garantir a aprovação dos testes que podem envolver ajustes na lógica do modelo, 
alterações na escrita dos cenários Gherkin ou atualizações nas funções de definição de passos.

Após a aprovação dos testes de uma história, todos os cenários previamente aprovados serão reexecutados. Dessa forma, é possível verificar que modificações realizadas 
para atender a um cenário específico não impactaram os demais, garantindo a robustez do sistema. 

Ao final do processo, todos os cenários referentes às histórias de usuário foram executados em conjunto, garantindo que o produto final contemplasse todas as 
funcionalidades mapeadas e que 100\% dos testes de aceitação fossem aprovados. Em seguida, foi realizada uma análise global sobre a aplicação do processo, destacando 
os benefícios da metodologia em comparação com alternativas existentes.

%--------------------------------------------------------------------------------------
% Insere a seção de cronograma
% Está comentada porque só é necessária no TCC I
%--------------------------------------------------------------------------------------

%\section{Cronograma} \label{sec:crono}

%A tabela \ref{tab:cronograma} mostra o cronograma de atividades a serem executadas para o TCC II, com base no calendário de 201X.Y da UNIVASF.

%\newpage
%\begin{table}[!thb]
%	%\huge
%    \centering
%    \caption{\label{tab:cronograma} Cronograma das atividades previstas para o TCC II}
%%    \begin{adjustbox}{max width=\textwidth}
%    \begin{tabular}{p{6.5cm}|c|c|c|c|c|c}
%    \toprule
%    \textbf{Atividade}                      & Nov & Dez & Jan & Fev & Mar & Abr \\ \hline
%    Implementar o banco de dados              & X    & X     &       &        &          &          \\ \hline
%    Desenvolver a API HTTP RESTful                      &   X   & X     &       &        &          &          \\ \hline
%    Implementar o serviço de captura de dados        &      &      & X     &   X     &          &          \\ \hline
%    Desenvolver a aplicação \textit{Web/mobile} para exibição dos dados         &      &      & X     &   X     &     X     &          \\ \hline
 %   Teste do sistema            &      &       &       &        & X        &          %\\ \hline
 %   Escrita do TCC II                       &   X   & X     & X     & X      & X        & X        \\ \hline
%   Defesa do TCC II                        &      &       &       &        &          & X       \\
%    \bottomrule
 %   \end{tabular}
 %   \end{adjustbox}
%    \legend{\textbf{Fonte:} O autor.}
%\end{table}

